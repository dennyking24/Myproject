<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
    <nav>
        <a href="index.html" class="home-link">Home</a>
        <h1>User Dashboard</h1>
        <button id="logout-btn">Logout</button>
    </nav>
</header>

<div id="available-rooms-section">
    <h3>Select a Room</h3>
    <label for="available-rooms">Available Rooms:</label>
    <select id="available-rooms"></select>
</div>


<div id="reservation-form">
    <h3>Manage Reservations</h3>
    
    <!-- Make a Reservation -->
    <h4>Make a Reservation</h4>
    <label for="room-id">Room ID:</label>
    <input type="number" id="room-id">
    <label for="check-in-date">Check-In Date:</label>
    <input type="date" id="check-in-date">
    <label for="check-out-date">Check-Out Date:</label>
    <input type="date" id="check-out-date">
    <button id="make-reservation-btn">Make Reservation</button>
    
    <!-- View Reservations -->
    <h4>View Reservations</h4>
    <button id="view-reservations-btn">View My Reservations</button>
    <table id="reservations-table" border="1" style="margin-top: 10px;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Room ID</th>
                <th>Check-In</th>
                <th>Check-Out</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    // Create a Reservation
    document.getElementById('make-reservation-btn').addEventListener('click', async () => {
        const roomId = document.getElementById('room-id').value;
        const checkIn = document.getElementById('check-in-date').value;
        const checkOut = document.getElementById('check-out-date').value;

        try {
            const response = await fetch('/api/reservations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                },
                body: JSON.stringify({ roomId, checkIn, checkOut }),
            });

            if (response.ok) {
                alert('Reservation successful!');
                fetchReservations(); // Refresh the reservations list
            } else {
                const error = await response.json();
                alert(`Error: ${error.message}`);
            }
        } catch (err) {
            alert('Failed to make reservation.');
        }
    });

    // View Reservations
    document.getElementById('view-reservations-btn').addEventListener('click', async () => {
        try {
            const response = await fetch('/api/reservations', {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                },
            });

            if (response.ok) {
                const reservations = await response.json();
                populateReservationsTable(reservations);
            } else {
                const error = await response.json();
                alert(`Error: ${error.message}`);
            }
        } catch (err) {
            alert('Failed to fetch reservations.');
        }
    });

    // Populate Reservations Table
    function populateReservationsTable(reservations) {
        const tbody = document.querySelector('#reservations-table tbody');
        tbody.innerHTML = ''; // Clear existing rows

        reservations.forEach((reservation) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${reservation.id}</td>
                <td>${reservation.room_id}</td>
                <td>${reservation.check_in}</td>
                <td>${reservation.check_out}</td>
                <td>${reservation.status}</td>
                <td>
                    <button onclick="updateReservation(${reservation.id})">Update</button>
                    <button onclick="cancelReservation(${reservation.id})">Cancel</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Update a Reservation
    async function updateReservation(reservationId) {
        const checkIn = prompt('Enter new Check-In Date (YYYY-MM-DD):');
        const checkOut = prompt('Enter new Check-Out Date (YYYY-MM-DD):');

        try {
            const response = await fetch(`/api/reservations/${reservationId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                },
                body: JSON.stringify({ checkIn, checkOut }),
            });

            if (response.ok) {
                alert('Reservation updated successfully!');
                fetchReservations();
            } else {
                const error = await response.json();
                alert(`Error: ${error.message}`);
            }
        } catch (err) {
            alert('Failed to update reservation.');
        }
    }

    // Cancel a Reservation
    async function cancelReservation(reservationId) {
        try {
            const response = await fetch(`/api/reservations/${reservationId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                },
            });

            if (response.ok) {
                alert('Reservation canceled successfully!');
                fetchReservations();
            } else {
                const error = await response.json();
                alert(`Error: ${error.message}`);
            }
        } catch (err) {
            alert('Failed to cancel reservation.');
        }
    }

    // Logout functionality
document.getElementById('logout-btn').addEventListener('click', () => {
    localStorage.clear();
    window.location.href = 'login.html';
});


// Fetch and populate available rooms
async function fetchAvailableRooms() {
    try {
        const response = await fetch('/api/rooms/available');
        if (response.ok) {
            const rooms = await response.json();
            populateAvailableRooms(rooms);
        } else {
            alert('Failed to fetch available rooms.');
        }
    } catch (error) {
        console.error('Error fetching available rooms:', error);
    }
}


function populateAllRooms(rooms) {
    const availableRoomsDropdown = document.getElementById('available-rooms');
    availableRoomsDropdown.innerHTML = ''; // Clear existing options
    rooms.forEach((room) => {
        const option = document.createElement('option');
        option.value = room.id;
        option.textContent = `Room ${room.room_number} - ${room.type} ($${room.price})`;
        availableRoomsDropdown.appendChild(option);
    });
}

// Call this function when the page loads
document.addEventListener('DOMContentLoaded', fetchAllRooms);


</script>

